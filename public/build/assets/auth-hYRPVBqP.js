import{y as l,x as g,u as p,r as f,j as h,q as S}from"./app-w268HYa9.js";const s=l.create({baseURL:"http://127.0.0.1:8000/api"});s.interceptors.request.use(o=>{const r=localStorage.getItem("user");if(r)try{const a=JSON.parse(r);a?.token&&(o.headers.Authorization=`Bearer ${a.token}`)}catch(a){console.error("Error parsing user from localStorage:",a)}return o});const u={login(o){return s.post("/login",o)},register(o){return s.post("/register",o)}},m=g("auth",()=>{const o=p(),r=f({data:null,token:"",permisos:""});async function a(t){try{const{data:e}=await u.login(t);return r.value.data=e.data,r.value.token=e.token,!0}catch(e){throw console.error("Error al iniciar sesiÃ³n:",e),e}}function c(){r.value.data=null,r.value.token="",localStorage.removeItem("user"),o.push("/login")}async function i(t){try{const{data:e}=await u.register(t);return r.value.data=e.data,r.value.token=e.token,!0}catch(e){throw console.error("Error al registrarse:",e),e}}function n(){const t=localStorage.getItem("user");t&&(r.value=JSON.parse(t))}return h(r,t=>{t&&t.token?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user")},{deep:!0}),S(()=>{n(),r.value?.token&&o.push("/facturacion")}),{user:r,login:a,register:i,cargarLocalStorage:n,logout:c}});export{s as a,m as u};
