import{y as i,x as l,u as g,r as p,j as f,q as h}from"./app-BIsRkKFh.js";const s=i.create({baseURL:"http://127.0.0.1:8000/api"});s.interceptors.request.use(a=>{const r=localStorage.getItem("user");if(r)try{const o=JSON.parse(r);o?.token&&(a.headers.Authorization=`Bearer ${o.token}`)}catch(o){console.error("Error parsing user from localStorage:",o)}return a});const u={login(a){return s.post("/login",a)},register(a){return s.post("/register",a)}},d=l("auth",()=>{const a=g(),r=p({data:null,token:"",permisos:""});async function o(t){try{const{data:e}=await u.login(t);return r.value.data=e.data,r.value.token=e.token,!0}catch(e){throw console.error("Error al iniciar sesiÃ³n:",e),e}}async function c(t){try{const{data:e}=await u.register(t);return r.value.data=e.data,r.value.token=e.token,!0}catch(e){throw console.error("Error al registrarse:",e),e}}function n(){const t=localStorage.getItem("user");t&&(r.value=JSON.parse(t))}return f(r,t=>{t&&t.token?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user")},{deep:!0}),h(()=>{n(),r.value?.token&&a.push("/facturacion")}),{user:r,login:o,register:c,cargarLocalStorage:n}});export{s as a,d as u};
