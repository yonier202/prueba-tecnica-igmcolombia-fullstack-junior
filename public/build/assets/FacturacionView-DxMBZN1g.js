import{u as L,_ as z}from"./Header-CSkIi5K8.js";import{r as y,i as O,j as q,k as P,c,a as e,b as F,t as d,d as m,l as A,v as g,m as w,e as S,w as I,F as T,n as M,o as u,p as G,q as H,s as J,f as N}from"./app-w268HYa9.js";import{u as K}from"./persona-C41yTrOM.js";import"./auth-hYRPVBqP.js";/* empty css            */const Q=(h,_)=>{const s=h.__vccOpts||h;for(const[p,b]of _)s[p]=b;return s},R={class:"bg-gray-50 min-h-screen flex flex-col items-center py-10"},W={class:"bg-white shadow-xl rounded-2xl p-8 w-full max-w-4xl space-y-6"},X={class:"text-2xl font-bold text-gray-800 border-b pb-2"},Y={class:"grid grid-cols-3 gap-3 items-end"},Z={key:0,class:"bg-green-50 border border-green-200 p-4 rounded-lg shadow-sm"},ee={class:"text-gray-700"},te={class:"text-gray-700"},ae={class:"grid grid-cols-2 gap-4"},oe={class:"grid grid-cols-2 gap-4"},ne={key:0,class:"mt-2"},se=["href"],re={class:"mt-6"},ie=["onUpdate:modelValue"],le=["onUpdate:modelValue"],de=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],ue=["onClick"],pe={class:"text-right mt-4"},me={class:"text-lg font-semibold text-gray-800"},ve={class:"text-green-600"},ge={class:"text-center"},_e={type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg px-6 py-2 shadow-md transition-colors"},be={__name:"FacturaForm",props:{factura:{type:Object,default:null}},emits:["close"],setup(h,{emit:_}){const s=K(),p=L(),b=h,C=_,x=y("CC"),v=y(""),$=y(!1),a=O({id:null,persona_id:null,numero_factura:"",descripcion:"",fecha_emision:"",fecha_vencimiento:"",estado:"pendiente",archivo_adjunto:null,items:[{nombre:"",cantidad:1,iva:19,precio_unitario:0}]}),k=()=>{Object.assign(a,{id:null,persona_id:null,numero_factura:"",descripcion:"",fecha_emision:"",fecha_vencimiento:"",estado:"pendiente",archivo_adjunto:null,items:[{nombre:"",cantidad:1,iva:19,precio_unitario:0}]}),x.value="CC",v.value="",s.personaEncontrada=null};q(()=>b.factura,async o=>{await G(),o?(a.id=o.id,a.persona_id=o.persona_id,a.numero_factura=o.numero_factura,a.descripcion=o.descripcion,a.fecha_emision=o.fecha_emision,a.fecha_vencimiento=o.fecha_vencimiento,a.estado=o.estado,a.items=o.items?.length?o.items.map(t=>({nombre:t.nombre,cantidad:t.cantidad,iva:t.iva,precio_unitario:t.precio_unitario})):[{nombre:"",cantidad:1,iva:19,precio_unitario:0}],s.personaEncontrada=o.persona||null,x.value=o.persona?.tipo_documento||"CC",v.value=o.persona?.numero_documento||""):k()},{immediate:!0});const V=P(()=>a.items.reduce((o,t)=>{const n=t.cantidad*t.precio_unitario,E=n*(t.iva/100);return o+n+E},0)),j=o=>{a.archivo_adjunto=o.target.files[0]},i=()=>{a.items.push({nombre:"",cantidad:1,iva:19,precio_unitario:0})},l=o=>{a.items.splice(o,1)},r=async()=>{await s.buscarPersona(x.value,v.value),s.personaEncontrada&&(a.persona_id=s.personaEncontrada.id)},D=async()=>{if(!a.persona_id){alert("Primero debes buscar y seleccionar una persona.");return}$.value=!0;const o=new FormData;o.append("persona_id",a.persona_id??""),o.append("numero_factura",a.numero_factura??""),o.append("descripcion",a.descripcion??""),o.append("fecha_emision",a.fecha_emision??""),o.append("fecha_vencimiento",a.fecha_vencimiento??""),o.append("estado",a.estado??"pendiente"),o.append("monto_total",V.value??0),a.archivo_adjunto instanceof File&&o.append("archivo_adjunto",a.archivo_adjunto),a.items.forEach((t,n)=>{o.append(`items[${n}][nombre]`,t.nombre??""),o.append(`items[${n}][cantidad]`,t.cantidad??1),o.append(`items[${n}][iva]`,t.iva??0),o.append(`items[${n}][precio_unitario]`,t.precio_unitario??0)});try{a.id?await p.actualizarFactura(a.id,o,{headers:{"Content-Type":"multipart/form-data"}}):await p.crearFactura(o,{headers:{"Content-Type":"multipart/form-data"}}),C("close"),k()}catch(t){if(console.error("❌ Error al guardar factura:",t),t.response?.data?.errors){const n=Object.keys(t.response.data.errors);alert(`⚠️ Campos faltantes o inválidos: ${n.join(", ")}`)}}finally{$.value=!1}};return(o,t)=>(u(),c("div",R,[e("div",W,[e("h2",X,d(a.id?"Editar Factura":"Crear Factura"),1),e("div",Y,[e("div",null,[t[8]||(t[8]=e("label",{class:"font-medium text-sm text-gray-700"},"Tipo Documento",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>x.value=n),class:"input"},[...t[7]||(t[7]=[e("option",{value:"CC"},"Cédula",-1),e("option",{value:"TI"},"Tarjeta Identidad",-1)])],512),[[A,x.value]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"font-medium text-sm text-gray-700"},"Número Documento",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>v.value=n),placeholder:"Número Documento",class:"input"},null,512),[[g,v.value]])]),e("button",{onClick:r,class:"bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg py-2 transition-colors"}," Buscar Persona ")]),w(s).personaEncontrada?(u(),c("div",Z,[e("p",ee,[t[10]||(t[10]=e("strong",null,"Cliente:",-1)),S(" "+d(w(s).personaEncontrada.nombres)+" "+d(w(s).personaEncontrada.apellidos),1)]),e("p",te,[t[11]||(t[11]=e("strong",null,"Email:",-1)),S(" "+d(w(s).personaEncontrada.email),1)])])):F("",!0),w(s).personaEncontrada?(u(),c("form",{key:1,onSubmit:I(D,["prevent"]),class:"space-y-5"},[e("div",ae,[e("div",null,[t[12]||(t[12]=e("label",{class:"font-medium text-sm text-gray-700"},"Número de Factura",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>a.numero_factura=n),placeholder:"Número de Factura",class:"input"},null,512),[[g,a.numero_factura]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"font-medium text-sm text-gray-700"},"Estado",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>a.estado=n),class:"input"},[...t[13]||(t[13]=[e("option",{value:"pendiente"},"Pendiente",-1),e("option",{value:"pagada"},"Pagada",-1),e("option",{value:"vencida"},"Vencida",-1)])],512),[[A,a.estado]])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"font-medium text-sm text-gray-700"},"Descripción",-1)),m(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=n=>a.descripcion=n),placeholder:"Descripción de la factura",class:"input h-24"},null,512),[[g,a.descripcion]])]),e("div",oe,[e("div",null,[t[16]||(t[16]=e("label",{class:"font-medium text-sm text-gray-700"},"Fecha de Emisión",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=n=>a.fecha_emision=n),class:"input"},null,512),[[g,a.fecha_emision]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"font-medium text-sm text-gray-700"},"Fecha de Vencimiento",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=n=>a.fecha_vencimiento=n),class:"input"},null,512),[[g,a.fecha_vencimiento]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"font-medium text-sm text-gray-700"},"Archivo Adjunto",-1)),e("input",{type:"file",onChange:j,class:"input"},null,32),b.factura?.archivo_adjunto?(u(),c("div",ne,[e("a",{href:b.factura.archivo_adjunto,target:"_blank",class:"text-indigo-600 underline"},"Ver archivo actual",8,se)])):F("",!0)]),e("div",re,[t[19]||(t[19]=e("h3",{class:"font-semibold text-lg text-gray-800 mb-2"},"Ítems",-1)),(u(!0),c(T,null,M(a.items,(n,E)=>(u(),c("div",{key:E,class:"grid grid-cols-5 gap-3 mb-2 bg-gray-50 p-3 rounded-lg border border-gray-200"},[m(e("input",{"onUpdate:modelValue":f=>n.nombre=f,placeholder:"Nombre",class:"input"},null,8,ie),[[g,n.nombre]]),m(e("input",{"onUpdate:modelValue":f=>n.cantidad=f,type:"number",min:"1",placeholder:"Cantidad",class:"input"},null,8,le),[[g,n.cantidad]]),m(e("input",{"onUpdate:modelValue":f=>n.precio_unitario=f,type:"number",min:"0",placeholder:"Precio",class:"input"},null,8,de),[[g,n.precio_unitario]]),m(e("input",{"onUpdate:modelValue":f=>n.iva=f,type:"number",min:"0",placeholder:"IVA (%)",class:"input"},null,8,ce),[[g,n.iva]]),e("button",{type:"button",onClick:f=>l(E),class:"bg-red-100 hover:bg-red-200 text-red-600 font-semibold rounded-lg text-sm"}," ✕ ",8,ue)]))),128)),e("button",{onClick:I(i,["prevent"]),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg px-4 py-1 transition-colors"}," + Añadir Ítem ")]),e("div",pe,[e("p",me,[t[20]||(t[20]=S(" Total: ",-1)),e("span",ve,"$"+d(V.value.toFixed(2)),1)])]),e("div",ge,[e("button",_e,d(a.id?"Actualizar Factura":"Guardar Factura"),1)])],32)):F("",!0)])]))}},B=Q(be,[["__scopeId","data-v-9061315e"]]),xe={class:"p-6 bg-gray-50 min-h-screen"},fe={class:"bg-white shadow-xl rounded-2xl p-6"},ye={class:"mb-4"},he={key:0,class:"text-center py-6 text-gray-500"},we={key:1,class:"overflow-x-auto"},Ce={class:"min-w-full text-sm text-left border border-gray-200 rounded-lg"},$e={class:"p-3"},Fe={class:"p-3"},ke={class:"p-3 font-medium text-gray-800"},Ve={class:"p-3 text-gray-600 truncate"},je={class:"p-3 font-semibold text-green-600"},Ee={class:"p-3"},Ue={class:"p-3 flex gap-2 justify-center"},Pe=["onClick"],Ne=["onClick"],De={key:2,class:"text-center py-6 text-gray-500"},Se={key:3,class:"flex justify-center items-center mt-4 gap-2"},Te=["disabled"],Ae={class:"text-gray-700 text-sm"},Ie=["disabled"],Le={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Me={class:"bg-white p-6 rounded-2xl shadow-xl w-full max-w-3xl relative max-h-[90vh] overflow-y-auto"},Be={class:"overflow-y-auto max-h-[80vh] pr-2"},U=5,ze={__name:"FacturaList",setup(h){const _=L(),s=y(""),p=y(1),b=y(!1),C=y(null);H(()=>{_.fetchFacturas()});const x=P(()=>{const i=s.value.toLowerCase();return _.facturas.filter(l=>l.numero_factura.toLowerCase().includes(i)||l.descripcion.toLowerCase().includes(i)||(l.persona?.nombres?.toLowerCase()||"").includes(i))}),v=P(()=>Math.ceil(x.value.length/U)),$=P(()=>{const i=(p.value-1)*U;return x.value.slice(i,i+U)}),a=i=>{i>=1&&i<=v.value&&(p.value=i)},k=async i=>{confirm("¿Seguro que deseas eliminar esta factura?")&&await _.eliminarFactura(i)},V=(i=null)=>{C.value=i,b.value=!0},j=()=>{b.value=!1,C.value=null};return(i,l)=>(u(),c("div",xe,[e("div",fe,[l[4]||(l[4]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold text-gray-800"}," Facturas")],-1)),e("div",ye,[m(e("input",{"onUpdate:modelValue":l[0]||(l[0]=r=>s.value=r),type:"text",placeholder:"Buscar por número, descripción o cliente...",class:"border border-gray-300 rounded-lg p-2 w-full focus:ring-2 focus:ring-indigo-400"},null,512),[[g,s.value]])]),w(_).loading?(u(),c("div",he," Cargando facturas... ")):$.value.length>0?(u(),c("div",we,[e("table",Ce,[l[3]||(l[3]=e("thead",{class:"bg-gray-100 text-gray-700 uppercase text-xs"},[e("tr",null,[e("th",{class:"p-3"},"#"),e("th",{class:"p-3"},"Cliente"),e("th",{class:"p-3"},"N° Factura"),e("th",{class:"p-3"},"Descripción"),e("th",{class:"p-3"},"Monto Total"),e("th",{class:"p-3"},"Estado"),e("th",{class:"p-3 text-center"},"Acciones")])],-1)),e("tbody",null,[(u(!0),c(T,null,M($.value,(r,D)=>(u(),c("tr",{key:r.id,class:"border-t hover:bg-gray-50 transition"},[e("td",$e,d((p.value-1)*U+D+1),1),e("td",Fe,d(r.persona?.nombres)+" "+d(r.persona?.apellidos),1),e("td",ke,d(r.numero_factura),1),e("td",Ve,d(r.descripcion),1),e("td",je," $"+d(r.monto_total),1),e("td",Ee,[e("span",{class:J({"bg-yellow-100 text-yellow-800 px-2 py-1 rounded":r.estado==="pendiente","bg-green-100 text-green-800 px-2 py-1 rounded":r.estado==="pagada","bg-red-100 text-red-800 px-2 py-1 rounded":r.estado==="vencida"})},d(r.estado),3)]),e("td",Ue,[e("button",{onClick:o=>V(r),class:"bg-indigo-100 hover:bg-indigo-200 text-indigo-600 px-2 py-1 rounded-md"}," Editar ",8,Pe),e("button",{onClick:o=>k(r.id),class:"bg-red-100 hover:bg-red-200 text-red-600 px-2 py-1 rounded-md"}," Eliminar ",8,Ne)])]))),128))])])])):(u(),c("div",De," No se encontraron facturas. ")),v.value>1?(u(),c("div",Se,[e("button",{onClick:l[1]||(l[1]=r=>a(p.value-1)),disabled:p.value===1,class:"px-3 py-1 rounded-md border bg-gray-100 hover:bg-gray-200 disabled:opacity-50"}," ◀ ",8,Te),e("span",Ae," Página "+d(p.value)+" de "+d(v.value),1),e("button",{onClick:l[2]||(l[2]=r=>a(p.value+1)),disabled:p.value===v.value,class:"px-3 py-1 rounded-md border bg-gray-100 hover:bg-gray-200 disabled:opacity-50"}," ▶ ",8,Ie)])):F("",!0)]),b.value?(u(),c("div",Le,[e("div",Me,[e("button",{onClick:j,class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl"}," ✕ "),e("div",Be,[N(B,{factura:C.value,onClose:j},null,8,["factura"])])])])):F("",!0)]))}},Ke={__name:"FacturacionView",setup(h){return(_,s)=>(u(),c(T,null,[e("div",null,[N(z)]),e("div",null,[N(B)]),e("div",null,[N(ze)])],64))}};export{Ke as default};
